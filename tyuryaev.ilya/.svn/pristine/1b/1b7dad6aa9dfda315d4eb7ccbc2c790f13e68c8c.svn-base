#ifndef BMP_H_
#define BMP_H_
#define calc_padding(x, y) (4 - (x * y) % 4) % 4

#include "stdint.h"
#include "stdio.h"
#include "string.h"

typedef struct bmp_header bmp_header_t;
typedef struct pixel pixel_t;

struct bmp_header
{
    uint16_t signature;
    uint32_t file_size;
    uint16_t reserved1;
    uint16_t reserved2;
    uint32_t pixel_array_offset;
} __attribute__((packed));

struct pixel
{
    uint8_t r;
    uint8_t g;
    uint8_t b;
};

void load_bmp(FILE *in_bmp, size_t pixel_array_offset,
              uint32_t w, uint32_t h, int padding, pixel_t **pixel_matrix);

void crop(pixel_t **pixel_matrix,
          int x, int y, int dx, int dy, pixel_t **fragment_matrix);

void rotate(pixel_t **fragment_matrix,
            int dx, int dy, pixel_t **rev_fragment_matrix);

void save_bmp(FILE *in_bmp, bmp_header_t header, pixel_t **rev_fragment_matrix,
              uint32_t old_image_size, int dx, int dy, FILE *out_bmp);

#endif